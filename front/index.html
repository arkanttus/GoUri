<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Tomorrow">
    <!--Import materialize.css-->
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Biblioteca AXIOS para AJAX -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>GoUri</title>

    <style>
        .title {
            display: inline-block;
            margin: 0;
        }

        ::-webkit-input-placeholder {
            color: #777;
        }

        /* label color */
        .input-field label {
            color: #444;
        }

        .input-field .prefix.active {
            color: #1e88e5;
        }

        /* label focus color */
        .input-field input[type=text]:focus+label {
            color: #1e88e5 !important;
        }

        /* label underline focus color */
        .input-field input[type=text]:focus {
            border-bottom: 1px solid #1e88e5 !important;
            box-shadow: 0 1px 0 0 #1e88e5 !important;
        }
    </style>
</head>

<body class="deep-purple">

    <div class="container">

        <div class="row">
            <div class="s6 center-align">
                <h3 style="font-family: Tomorrow">
                    <p class="title">Go</p>
                    <p class="blue-text accent-1-text title">Uri</p>
                </h3>
            </div>
        </div>

        <div class="row">
            <div class="col s12 m6 offset-m3">
                <div class="card">
                    <div class="card-content">
                        <form>

                            <div class="input-field">
                                <i class="material-icons prefix">account_circle</i>
                                <input id="icon_prefix" type="text" class="validate input1">
                                <label for="icon_prefix" class="lb1">
                                    Id usuários
                                </label>
                            </div>
                            <div class="input-field">
                                <i class="material-icons prefix">format_list_bulleted</i>
                                <input id="icon_telephone" type="text" class="validate input2">
                                <label for="icon_telephone" class="lb2">
                                    Id problemas
                                </label>
                            </div>

                            <button class="btn btn-block waves-effect waves-light" type="submit" name="action"
                                style="width: 100%; background-color: #1e88e5;">
                                Procurar
                                <i class="material-icons right">send</i>
                            </button>


                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col s12 m6 offset-m3">
                <ul class="collection list-users" style="display: none;">
                </ul>
            </div>
        </div>
    </div>


    <!--JavaScript at end of body for optimized loading-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
        

        document.addEventListener('DOMContentLoaded', async function () {
            var input1 = document.querySelector('.input1');
            var input2 = document.querySelector('.input2');

            input1.addEventListener('focus', function () {
                input1.setAttribute('placeholder', 'Separe os ids por vírgula e sem espaço!')
            })

            input1.addEventListener('blur', function () {
                input1.removeAttribute('placeholder')
                document.querySelector('.lb1').classList.remove('active')
            })

            input2.addEventListener('focus', function () {
                input2.setAttribute('placeholder', 'Separe os ids por vírgula e sem espaço!')
            })

            input2.addEventListener('blur', function () {
                input2.removeAttribute('placeholder')
                document.querySelector('.lb2').classList.remove('active')
            })

            var form = document.querySelector('form')
            
            form.addEventListener('submit', e => {
                e.preventDefault()

                if (input1.value === '' || input2.value === ''){
                    M.toast({html: 'Preencha os campos!'})
                    return false
                }

                const users = input1.value.split(',')

                var lista  = document.querySelector('.list-users')

                users.map(async user => {
                    const response = await axios.post('http://localhost:5000/scrap', {id: user})
                        
                    data = response.data

                    console.log(data)

                    var card = "<li class='collection-item avatar'>\
                                    <img src='"+data.avatar+"' alt='' class='circle'>\
                                    <span class='title'>"+ data.username +"</span>\
                                    <p>Resolvidos: </p>\
                                    <p>Não resolvidos: </p>\
                                </li>"

                    lista.innerHTML += card
                    

                    lista.style.display = 'block'
                })

                /*const render = async () => {
                    const responses =  await axios.post('http://localhost:5000/scrap', users)
                        
                    response = responses.data

                    for(var key in response){
                        data = response[key]

                        var card = "<li class='collection-item avatar'>\
                                        <img src='"+data.avatar+"' alt='' class='circle'>\
                                        <span class='title'>"+ data.username +"</span>\
                                        <p>Resolvidos: </p>\
                                        <p>Não resolvidos: </p>\
                                    </li>"

                        lista.innerHTML += card
                    }

                    lista.style.display = 'block'
                      
                }*/

                //render()
                
                console.log('foe')
            })
        });
    </script>
</body>

</html>